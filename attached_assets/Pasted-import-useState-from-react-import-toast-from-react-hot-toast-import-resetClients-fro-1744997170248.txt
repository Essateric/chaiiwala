import { useState } from "react";
import toast from "react-hot-toast";
import { resetClients } from "../scripts/resetClients";
import { exportClientsToCSV } from "../scripts/exportClients";
import CsvStaffUploader from "../components/CsvStaffUploader";
import CsvClientUploader from "../components/CsvClientUploader";
import Button from "../components/Button";
import ImportClientsButton from "../components/ImportClientsButton";

export default function Settings() {
  const [seedingClients, setSeedingClients] = useState(false);

  const handleSeedClients = async () => {
    setSeedingClients(true);
    toast.loading("Seeding clients...");
    try {
      await seedClients();
      toast.dismiss();
      toast.success("Clients seeded successfully");
    } catch {
      toast.dismiss();
      toast.error("Failed to seed clients.");
    } finally {
      setSeedingClients(false);
    }
  };

  return (
    <div className="p-6 text-black space-y-8">
      <h1 className="text-2xl font-bold text-bronze">Settings</h1>

      {/* CSV Upload */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        <SettingCard
          title="Import Staff Data"
          description="Upload a CSV to bulk import staff and services."
          content={<CsvStaffUploader />}
        />
        <SettingCard
          title="Import Client Data"
          description="Upload a CSV to bulk import client records and treatment history."
          content={<CsvClientUploader />}
        />
      </div>

      {/* JSON Upload */}
      <div className="bg-gray-100 p-4 rounded shadow-sm space-y-3">
        <h2 className="text-lg font-semibold text-bronze">Import Clients from JSON</h2>
        <p className="text-sm text-gray-600">
          Upload pre-formatted clients directly into Firebase (bypasses CSV).
        </p>
        <ImportClientsButton />
      </div>

      {/* Export Clients */}
      <div className="bg-gray-100 p-4 rounded shadow-sm space-y-3">
        <h2 className="text-lg font-semibold text-bronze">Export Clients</h2>
        <p className="text-sm text-gray-600">
          Download a CSV of all clients in your system.
        </p>
        <Button onClick={exportClientsToCSV}>Export Clients to CSV</Button>
      </div>

      {/* Danger Zone */}
      <div className="bg-gray-100 p-4 rounded shadow-sm space-y-3">
        <h2 className="text-lg font-semibold text-bronze">Danger Zone</h2>
        <p className="text-sm text-gray-600">
          This will permanently delete all client records from the database.
        </p>
        <Button disabled className="bg-gray-400 cursor-not-allowed">
          Delete All Clients (disabled)
        </Button>
      </div>
    </div>
  );
}

// Reusable card layout
function SettingCard({ title, description, buttonLabel, onClick, disabled, content }) {
  return (
    <div className="bg-gray-100 p-4 rounded shadow-sm space-y-3">
      <h2 className="text-lg font-semibold text-bronze">{title}</h2>
      <p className="text-sm text-gray-600">{description}</p>
      {content ? content : (
        <Button onClick={onClick} disabled={disabled}>
          {buttonLabel}
        </Button>
      )}
    </div>
  );
}
